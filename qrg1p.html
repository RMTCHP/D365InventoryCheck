<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üì¶ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Inventory TAG</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
  <style>
    :root {
      --primary-color: #2563eb;
      --accent-color: #059669;
      --accent-hover: #047857;
      --success-color: #10b981;
      --error-color: #dc2626;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --border-color: #e2e8f0;
      --background: #f8fafc;
      --surface: #ffffff;
      --radius-lg: 0.75rem;
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      color: var(--text-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      min-height: 100vh;
    }

    .container { width: 100%; max-width: 480px; }

    .card {
      background: var(--surface);
      padding: 32px 24px;
      border-radius: 1rem;
      box-shadow: var(--shadow-lg);
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
    }

    .header h2 {
      font-size: 24px;
      font-weight: 700;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      margin-bottom: 8px;
      font-weight: 600;
      display: block;
    }

    .barcode-row {
      display: flex;
      gap: 8px;
    }

    .form-control {
      padding: 14px 16px;
      width: 100%;
      font-size: 16px;
      border: 1.5px solid var(--border-color);
      border-radius: var(--radius-lg);
    }

    button {
      border: none;
      border-radius: var(--radius-lg);
      padding: 14px 16px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-primary {
      width: 100%;
      background: var(--primary-color);
      color: white;
      margin-top: 16px;
    }

    .btn-scanner {
      background: var(--accent-color);
      color: white;
      font-size: 20px;
      min-width: 60px;
    }

    .btn-scanner:hover {
      background: var(--accent-hover);
    }

    #scanner-view {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #000;
      z-index: 1000;
    }

    #scanner-container {
      width: 100%;
      height: 100%;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #scanner-container video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .scanner-ui {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      z-index: 1001;
    }

    .scanner-header, .scanner-footer {
      padding: 20px;
      color: white;
      text-align: center;
      background: rgba(0,0,0,0.5);
    }

    .btn-close-scanner {
      background: rgba(220,38,38,0.9);
      color: white;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      font-size: 24px;
    }

    .scan-box {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 250px;
      height: 250px;
      border: none;
      border-radius: 20px;
      z-index: 1002;
      box-shadow: 0 0 0 4000px rgba(0,0,0,0.7);
    }

    .scan-corners {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 250px;
      height: 250px;
      z-index: 1003;
    }

    .corner {
      position: absolute;
      width: 40px;
      height: 40px;
      border: 4px solid #00ff00;
      border-radius: 8px;
    }

    .corner::before {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border: 2px solid #00ff00;
      border-radius: 4px;
      opacity: 0.6;
      animation: corner-pulse 2s infinite;
    }

    .corner.top-left {
      top: -4px;
      left: -4px;
      border-right: none;
      border-bottom: none;
    }

    .corner.top-right {
      top: -4px;
      right: -4px;
      border-left: none;
      border-bottom: none;
    }

    .corner.bottom-left {
      bottom: -4px;
      left: -4px;
      border-right: none;
      border-top: none;
    }

    .corner.bottom-right {
      bottom: -4px;
      right: -4px;
      border-left: none;
      border-top: none;
    }

    .scan-grid {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 200px;
      height: 200px;
      opacity: 0.3;
      z-index: 1004;
    }

    .grid-line {
      position: absolute;
      background: #00ff00;
    }

    .grid-line.horizontal {
      width: 100%;
      height: 1px;
    }

    .grid-line.vertical {
      height: 100%;
      width: 1px;
    }

    .grid-line:nth-child(1) { top: 25%; }
    .grid-line:nth-child(2) { top: 50%; }
    .grid-line:nth-child(3) { top: 75%; }
    .grid-line:nth-child(4) { left: 25%; }
    .grid-line:nth-child(5) { left: 50%; }
    .grid-line:nth-child(6) { left: 75%; }

    .scan-line {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 220px;
      height: 2px;
      background: linear-gradient(to right, transparent, #00ff00, transparent);
      animation: qr-scan-move 3s infinite;
      z-index: 1005;
    }

    @keyframes qr-scan-move {
      0% { top: calc(50% - 110px); opacity: 0.8; }
      50% { top: 50%; opacity: 1; }
      100% { top: calc(50% + 110px); opacity: 0.8; }
    }

    @keyframes corner-pulse {
      0% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
      100% { opacity: 0.6; transform: scale(1); }
    }

    .scan-guide-text {
      position: absolute;
      top: 25%;
      width: 100%;
      text-align: center;
      color: #fff;
      font-size: 18px;
      font-weight: 500;
      z-index: 1004;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    }

    .scan-status {
      position: absolute;
      bottom: 25%;
      width: 100%;
      text-align: center;
      color: #00ff00;
      font-size: 16px;
      font-weight: 400;
      z-index: 1004;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
    }

    input[type="number"]::-webkit-inner-spin-button {
      display: none;
    }

    input[type="number"] {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" id="main-view">
      <div class="header">
        <h2>üì¶ RMT InventoryTAG G1P</h2>
      </div>
      <div class="form-group">
        <label class="form-label">‡∏£‡∏´‡∏±‡∏™ QR Code</label>
        <div class="barcode-row">
          <input type="text" id="barcode" class="form-control" placeholder="‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô QR Code" readonly>
          <button class="btn-scanner" onclick="startScanner()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3 11h8V3H3v8zm2-6h4v4H5V5zM3 21h8v-8H3v8zm2-6h4v4H5v-4zM13 3v8h8V3h-8zm6 6h-4V5h4v4zM13 13h2v2h-2v-2zM15 15h2v2h-2v-2zM13 17h2v2h-2v-2zM15 19h2v2h-2v-2zM17 13h2v2h-2v-2zM19 15h2v2h-2v-2zM17 17h2v2h-2v-2zM19 19h2v2h-2v-2z"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="form-group">
<!-- üîΩ ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å -->
<div class="form-group">
  <label class="form-label">‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å</label>
  <select id="mainProcess" class="form-control" onchange="handleMainProcessChange()">
  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å --</option>
  <option value="‡∏ú‡∏™‡∏°‡∏ú‡∏á">‡∏ú‡∏™‡∏°‡∏ú‡∏á</option>
  <option value="Compacting">Compacting</option>
  <option value="Sinter">Sinter</option>
  <option value="Magna Flux">Magna Flux</option>
  <option value="Finishing">Finishing</option>
  <option value="Machining">Machining</option>
  <option value="Delivery">Delivery</option>
  <option value="Receiving">Receiving</option>
  <option value="QC Check">QC Check</option>
  <option value="Sort">Sort</option>
  <option value="Packing">Packing</option>
</select>
</div>

<!-- üîΩ ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢ -->
<div class="form-group">
  <label class="form-label">‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢</label>
  <select id="subProcess" class="form-control">
    <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢ --</option>
  </select>
</div>
        <!-- üîΩ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
        <div class="form-group">
  <label for="status" class="form-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
  <select id="status" class="form-control">
  <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --</option>
</select>
</div>

        <label class="form-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</label>
        <input type="number" id="quantity" inputmode="numeric" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
      </div>

      
      <div class="form-group">
        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡πÅ‡∏Å‡∏ô</label>
        <input type="text" id="scanner" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡πÅ‡∏Å‡∏ô">
      </div>
      <button class="btn-primary" onclick="submitBarcode()" style="font-size:18px;">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <p style="text-align:center; margin-top: 12px; font-size: 12px; color: #64748b;">
  ¬© 2025 Resonac Materials (Thailand) Co., Ltd.
</p>
    </div>
  </div>

  <!-- Scanner View -->
  <div id="scanner-view">
    <div id="scanner-container"></div>
    <div class="scanner-ui">
      <div class="scanner-header">
        <h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô QR Code</h3>
      </div>
      <div class="scanner-footer">
        <button class="btn-close-scanner" onclick="stopScanner()">‚úï</button>
      </div>
      <div class="scan-guide-text">‡∏ß‡∏≤‡∏á QR Code ‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°</div>
      <div class="scan-box"></div>
      <div class="scan-corners">
        <div class="corner top-left"></div>
        <div class="corner top-right"></div>
        <div class="corner bottom-left"></div>
        <div class="corner bottom-right"></div>
      </div>
      <div class="scan-grid">
        <div class="grid-line horizontal"></div>
        <div class="grid-line horizontal"></div>
        <div class="grid-line horizontal"></div>
        <div class="grid-line vertical"></div>
        <div class="grid-line vertical"></div>
        <div class="grid-line vertical"></div>
      </div>
      <div class="scan-line"></div>
      <div class="scan-status">üì± ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ QR Code...</div>
    </div>
  </div>

  <audio id="beep" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg" preload="auto"></audio>

  <script>
  const apiURL = "https://script.google.com/macros/s/AKfycbyN53PUZmm6400mwuOvsyX2yQadAgMHlHqRXLHTQ_fiyh8G9Dh3z0qjX1GRDZIjRw/exec";
  let codeReader;

  async function submitBarcode() {
  const barcode = document.getElementById("barcode").value.trim();
  const quantity = document.getElementById("quantity").value.trim();
  const scanner = document.getElementById("scanner").value.trim();
  const mainProcess = document.getElementById("mainProcess").value.trim();
  const subProcess = document.getElementById("subProcess").value.trim();
  const status = document.getElementById("status").value.trim();

  // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
  if (!barcode || !quantity || !scanner || !mainProcess || !subProcess || !status) {
    Swal.fire({
      icon: "error",
      title: "‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö",
      text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á",
    });
    return;
  }

  // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ quantity ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÅ‡∏•‡∏∞‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0
  if (isNaN(quantity) || Number(quantity) <= 0) {
    Swal.fire({
      icon: "warning",
      title: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
      text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0",
    });
    return;
  }

  // ‚úÖ ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°‡∏Ç‡∏≠‡∏á subProcess
  const subProcessText = document.querySelector('#subProcess option:checked')?.textContent || '-';
  const mainProcessText = mainProcess || '-';
  const statusText = status || '-';

  const confirmResult = await Swal.fire({
    title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å",
    html: `
      <div style="text-align: left">
        <fieldset style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
          <legend><strong>üîé ‡∏£‡∏´‡∏±‡∏™ QR Code</strong></legend>
          <p>${barcode}</p>
        </fieldset>

        <fieldset style="border: 1px solid #ccc; padding: 10px;">
          <legend><strong>üìã ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</strong></legend>
          <p><strong>‚öôÔ∏è ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å:</strong> ${mainProcessText}</p>
          <p><strong>üß© ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢:</strong> ${subProcessText}</p>
          <p><strong>üìå ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${statusText}</p>
          <p><strong>üî¢ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</strong> ${quantity}</p>
          <p><strong>üë§ ‡∏ú‡∏π‡πâ‡∏™‡πÅ‡∏Å‡∏ô:</strong> ${scanner}</p>
        </fieldset>
      </div>
    `,
    icon: "question",
    showCancelButton: true,
    confirmButtonText: "‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
    cancelButtonText: "‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
  });

  if (!confirmResult.isConfirmed) return;

  Swal.fire({
    title: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...",
    allowOutsideClick: false,
    didOpen: () => {
      Swal.showLoading();
    },
  });

  try {
    const res = await fetch(`${apiURL}?page=submitBarcode&barcode=${barcode}&quantity=${quantity}&scanner=${scanner}&mainProcess=${mainProcess}&subProcess=${subProcess}&status=${status}`, {
  method: "POST"
});
    const data = await res.json();

    if (data.success) {
      Swal.fire({
        icon: "success",
        title: "‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
        timer: 2000,
        showConfirmButton: false,
      });
      document.getElementById("barcode").value = "";
      document.getElementById("quantity").value = "";
      document.getElementById("mainProcess").value = "";
      document.getElementById("subProcess").innerHTML = "<option value=''>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢ --</option>";
      document.getElementById("subProcess").disabled = true;
      document.getElementById("status").innerHTML = "<option value=''>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --</option>";
    } else {
      Swal.fire({
        icon: "error",
        title: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
        text: data.message,
      });
    }
  } catch (err) {
    Swal.fire({
      icon: "error",
      title: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå",
      text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
    });
    console.error(err);
  }
}


  // üü¢ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô QR ‡∏î‡πâ‡∏ß‡∏¢ ZXing
async function startScanner() {
  document.getElementById("main-view").style.display = "none";
  document.getElementById("scanner-view").style.display = "block";

  codeReader = new ZXing.BrowserMultiFormatReader();
  const videoElem = document.createElement("video");
  videoElem.setAttribute("autoplay", true);
  videoElem.setAttribute("muted", true);
  videoElem.setAttribute("playsinline", true);
  videoElem.style.width = "100%";
  videoElem.style.height = "100%";
  videoElem.style.objectFit = "cover";

  const container = document.getElementById("scanner-container");
  container.innerHTML = ""; // ‡∏•‡πâ‡∏≤‡∏á‡∏Å‡πà‡∏≠‡∏ô
  container.appendChild(videoElem);

  try {
    const constraints = { video: { facingMode: 'environment' } };
    await codeReader.decodeFromConstraints(constraints, videoElem, (result, err) => {
      if (result) {
        const cleanedText = result.text.replace(/\s*MW6 Demo\s*$/i, '').trim();
        document.getElementById("barcode").value = cleanedText;
        document.getElementById("beep").play();
        stopScanner();
      }
    });
  } catch (err) {
    console.error("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á:", err);
    Swal.fire({ icon: "error", title: "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á", text: err.message });
    stopScanner();
  }
}

// üî¥ ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πÅ‡∏Å‡∏ô
function stopScanner() {
  if (codeReader) {
    codeReader.reset();
  }
  document.getElementById("scanner-container").innerHTML = "";
  document.getElementById("scanner-view").style.display = "none";
  document.getElementById("main-view").style.display = "block";
}
function handleMainProcessChange() {
  const main = document.getElementById("mainProcess").value;
  const sub = document.getElementById("subProcess");
  const statusSelect = document.getElementById("status");

  sub.innerHTML = "";
  statusSelect.innerHTML = "";

  const processMap = {
    "Compacting": {
      sub: [["P", "P - Compact"]],
      statusMap: {
        "P": []  // ‚ûú ‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô "‡πÑ‡∏°‡πà‡∏°‡∏µ" ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤
      }
    },
    "Sinter": {
      sub: [
        ["S", "S - Sinter"],
        ["ESE", "ESE - Check Crack"],
        ["OD", "OD - Oil Dip"]
      ],
      statusMap: {
        "S": [
          "Green Part",
          "Quarantine Green Part",
          "Sinter OK",
          "Quarantine Sinter"
        ],
        "ESE": [
          "‡∏£‡∏≠ Check Crack",
          "Check Crack OK",
          "Quarantine Check Crack"
        ],
        "OD": ["Oil Dip OK"]
      }
    },
    "Finishing": {
      sub: [
        ["OD", "OD - Oil Dip"],
        ["SB", "SB - Shot blast"],
        ["OG", "OG - Impreganate"],
        ["RP", "RP - Sizing"]
      ],
      statusMap: {
        "OD": ["‡∏£‡∏≠ Oil Dip", "Oil Dip OK"],
        "SB": ["‡∏£‡∏≠ Shot blast", "Shot blast OK", "Quarantine Shot blast"],
        "OG": ["‡∏£‡∏≠‡∏≠‡∏±‡∏î‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô", "‡∏≠‡∏±‡∏î‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô OK"],
        "RP": ["‡∏£‡∏≠ Sizing", "Sizing OK", "Quarantine Sizing"]
      }
    },
    "Machining": {
      sub: [
        ["NCL", "NCL - NC Lathe"],
        ["GC", "GC - Grinding"]
      ],
      statusMap: {
        "NCL": ["‡∏£‡∏≠‡∏Å‡∏•‡∏∂‡∏á", "‡∏Å‡∏•‡∏∂‡∏á OK", "Quarantine NC Lathe"],
        "GC": ["‡∏£‡∏≠‡πÄ‡∏à‡∏µ‡∏¢‡∏£", "‡πÄ‡∏à‡∏µ‡∏¢‡∏£ OK", "Quarantine Grinding"]
      }
    },
    "Delivery": {
      sub: [["DELS", "DELS - Sub Con"]],
      status: ["‡∏£‡∏≠‡∏™‡πà‡∏á Sub Con"]
    },
    "Receiving": {
      sub: [["RECS", "RECS - PC"]],
      status: ["‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô OK - Sub con"]
    },
    "QC Check": {
      sub: [["K", "K - QC Check"]],
      status: ["‡∏£‡∏≠ QC Check"]
    },

    // ‚úÖ ‡∏≠‡∏∑‡πà‡∏ô ‡πÜ ‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°
    "Sort": {
      sub: [["SEL", "SEL - Sort"]],
      status: ["‡∏£‡∏≠ Sort", "Sort OK", "Quarantine Sort"]
    },
    "Packing": {
      sub: [["KON", "KON - Pack"]],
      status: ["‡∏£‡∏≠ Pack", "Pack OK FG1", "Re - Oil", "Quarantine Pack"]
    },
    "Magna Flux": {
      sub: [["SEM", "SEM - Magna Flux"]],
      statusMap: {
        "SEM": [
          "‡∏£‡∏≠ Magna Flux - Blank Part",
          "‡∏£‡∏≠ Magna Flux - FG Part",
          "Magna Flux OK",
          "Quarantine Magna Flux"
        ]
      }
    },
    "‡∏ú‡∏™‡∏°‡∏ú‡∏á": {
      sub: [["", "‡πÑ‡∏°‡πà‡∏°‡∏µ"]],
      status: ["‡∏ú‡∏á‡πÄ‡∏´‡∏•‡πá‡∏Å(RM)", "‡∏ú‡∏á‡∏õ‡∏±‡πà‡∏ô(Mix)"]
    }
  };

  const selected = processMap[main];

  // üî∏ ‡∏™‡∏£‡πâ‡∏≤‡∏á dropdown ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢
  if (selected) {
    sub.disabled = false;
    sub.style.backgroundColor = "#ffffff";
    selected.sub.forEach(([value, label]) => {
      const option = document.createElement("option");
      option.value = value;
      option.text = label;
      sub.appendChild(option);
    });
  } else {
    sub.disabled = true;
    sub.style.backgroundColor = "#e5e7eb";
    sub.innerHTML = "<option value=''>-- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• --</option>";
  }

  // üîπ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏¢ ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏´‡∏ô‡∏î status ‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á
  sub.onchange = () => {
    const subVal = sub.value;
    statusSelect.innerHTML = "";
    const subStatuses = selected.statusMap?.[subVal] || selected.status || [];

    if (subStatuses.length > 0) {
      statusSelect.disabled = false;
      statusSelect.style.backgroundColor = "#ffffff";
      const defaultOption = document.createElement("option");
      defaultOption.value = "";
      defaultOption.text = "-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ --";
      statusSelect.appendChild(defaultOption);

      subStatuses.forEach(status => {
        const option = document.createElement("option");
        option.value = status;
        option.textContent = status;
        statusSelect.appendChild(option);
      });
    } else {
      // ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‚ûú ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á "‡πÑ‡∏°‡πà‡∏°‡∏µ" ‡πÅ‡∏ö‡∏ö‡πÄ‡∏ó‡∏≤
      statusSelect.disabled = true;
      statusSelect.style.backgroundColor = "#e5e7eb";
      statusSelect.innerHTML = "<option value=''>‡πÑ‡∏°‡πà‡∏°‡∏µ</option>";
    }
  };

  // üü¢ ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡πÅ‡∏Ñ‡πà 1 sub-option ‡πÉ‡∏´‡πâ trigger ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  if (selected.sub.length === 1) {
    sub.dispatchEvent(new Event("change"));
  }
}


</script>

</body>
</html>
